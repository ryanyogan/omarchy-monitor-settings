#!/bin/bash

# Pre-commit script for hyprland-monitor-tui
# Runs comprehensive linting and testing to ensure code quality

set -e  # Exit on any error

echo "ğŸ” Running pre-commit checks for hyprland-monitor-tui..."
echo

# 1. Go vet - Check for potential issues
echo "ğŸ“‹ Running go vet..."
go vet ./...
echo "âœ… go vet passed"
echo

# 2. Go fmt - Check code formatting
echo "ğŸ¨ Running go fmt..."
go fmt ./...
echo "âœ… go fmt passed"
echo

# 3. Go mod tidy - Clean up dependencies
echo "ğŸ“¦ Running go mod tidy..."
go mod tidy
echo "âœ… go mod tidy passed"
echo

# 4. Build check - Ensure clean compilation
echo "ğŸ”¨ Running build check..."
go build -o hyprland-monitor-tui .
echo "âœ… Build check passed"
echo

# 5. Race detection tests - Check for concurrency issues
echo "ğŸƒ Running tests with race detection..."
go test -race ./...
echo "âœ… Race detection tests passed"
echo

# 6. Static analysis - Advanced code quality checks
echo "ğŸ”¬ Running staticcheck..."
if command -v staticcheck &> /dev/null; then
    staticcheck ./...
    echo "âœ… staticcheck passed"
else
    echo "âš ï¸  staticcheck not installed, skipping (install with: go install honnef.co/go/tools/cmd/staticcheck@latest)"
fi
echo

# 7. Full test suite - Comprehensive testing
echo "ğŸ§ª Running full test suite..."
go test -v ./...
echo "âœ… Full test suite passed"
echo

# Cleanup build artifact
rm -f hyprland-monitor-tui

echo "ğŸ‰ All pre-commit checks passed! Ready to commit."
echo "ğŸ“Š Summary:"
echo "   âœ… Code quality: Clean"
echo "   âœ… Formatting: Consistent"
echo "   âœ… Dependencies: Up-to-date"
echo "   âœ… Compilation: Error-free"
echo "   âœ… Tests: All passing"
echo "   âœ… Race conditions: None detected"
echo "   âœ… Static analysis: Clean" 